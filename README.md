# POST BACK Сервис

## Краткое описание

Сервис принимает от клиентов данные о действиях пользователей после редиректа
на страницы клиента. 

Данные передаются ввиде значений параметров. Имена параметров индивидуальны для 
каждого клиента.

## API

Для передачи данных о действиях клиента необходимо использовать следующий метод:

```
GET|POST postback.service/api/{clientName}?{user_id}=x&{code}=y&{aim}={reg|dep|dep_without_reg}
```
 * `postback.service` - днс имя сервиса, 
 * `{clientName}` - имя клиента
 * `{user_id}` - имя параметра идентификатора пользователя
 * `{code}` - имя параметра идентификатора перехода
 * `{aim}` - имя параметра действия пользователя, может принимать следующие
 значения:
    * `reg` - пользователь зарегистрировался
    * `dep` - пользователь совершил покупку с регистрацией
    * `dep_without_reg` - пользователь совершил покупку без регистрации
    
Ответы:

* `404 status` - клиент с таким именем не найден, обратитесь к администратору
* `400 status` - запрос некорректен. Проверьте имена параметров, значения для `aim`
параметра
* `503 status` - ошибка сервера
    
### Маппинг параметров для клиентов

Так как имена параметров для клиента сугубо индивидуальны, то для соотнесения
клиентских параметров и системных используется маппинг параметров. 

Маппинг параметров хранится в таблице `public.mapping`, где имена колонок
соответствуют системным именам параметров (плюс имя клиента как ключ), а значения -
именам параметров клиента.

API для импорта маппинга следующее:

```
POST postback.service/api/mapping
``` 

Файл csv, содержащий маппинг, передается как тело запроса.

Формат файла следующий:

```csv
client_name,user_id,code,aim
some-client,user,click_id,goal
```
 Заголовок обязателен, колонки должны иметь имена `client_name|user_id|code|aim`.
 Порядок колонок неважен. Разделитель `,`.
 
 > Если передаете через Postman, то выбираете **body** -> **binary** -> **select
 file** и тип запроса **Post**. 